---
import Dashboard from "../../../layouts/Dashboard.astro";

const categoryResp = await fetch("http://localhost:3000/api/categories");
const categories = await categoryResp.json();

if (Astro.request.method === "POST") {
    const data = await Astro.request.formData();
    const body = {
        name: data.get("name"),
        price: Number(data.get("price")),
        stock: Number(data.get("stock")),
        category_id: data.get("category_id"),
    };

    // Kirim data ke Server untuk  membuat produk baru
    await fetch("http://localhost:3000/api/products", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(body),
    });

    return Astro.redirect("/dashboard/products");
}
---

<Dashboard title="Products">
    <form method="POST" class="max-w-3xl">
        <section class="bg-white rounded-xl shadow-sm">
            <!-- Header -->
            <div class="px-6 py-4 border-b">
                <h2 class="font-bold text-2xl">Create Product</h2>
                <p class="text-sm text-gray-500">Tambahkan produk baru ke sistem</p>
            </div>
            
            <!-- Form -->
            <div class="p-6 space-y-5">
                <!-- Product name -->
                <div>
                    <label for="Nama-Produk" class="block text-sm font-medium mb-1">
                        Product Name
                    </label>
                    <input type="text" name="name" placeholder="Masukkan nama produk" class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-500 outline-none" required/>
                </div>

                <!-- Category -->
                <div>
                    <label for="Kategori-Produk" class="block text-sm font-medium mb-1">
                        Category
                    </label>
                    <select name="category_id" class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-500 outline-none" required>
                        <option value="">-- Pilih Kategori --</option>
                        {categories.map((cat: any) => (
                            <option value={cat.id}>{cat.name}</option>
                        ))}
                    </select>
                </div>

                <!-- Price & Stock -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Price -->
                    <div>
                        <label for="Harga-Produk" class="block text-sm font-medium mb-1">
                            Price
                        </label>
                        <input type="number" name="price" placeholder="Masukkan harga produk" class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-500 outline-none" required/>
                    </div>

                    <!-- Stock -->
                    <div>
                        <label for="Stok-Produk" class="block text-sm font-medium mb-1">
                            Stock
                        </label>
                        <input type="number" name="stock" placeholder="Masukkan stok produk" class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-500 outline-none" required/>
                    </div>
                </div>
            </div>

            <!-- Button -->
            <div class="px-6 py-4 border-t flex justify-end gap-3">
                <a href="/dashboard/products" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">
                    Cancel
                </a>
                <button type="submit" class="px-5 py-2 rounded-lg bg-pink-500 text-white hover:bg-pink-600">
                    Save
                </button>
            </div>
        </section>
    </form>
</Dashboard>