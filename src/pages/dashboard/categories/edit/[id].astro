---
import Dashboard from "../../../../layouts/Dashboard.astro";

const { id } = Astro.params;
const resp = await fetch(`http://localhost:3000/api/categories/${id}`);
const category = await resp.json();

if (Astro.request.method === "POST") {
    const data = await Astro.request.formData();
    const body = {
        name: data.get("category"),
    };

    // Kirim data ke Server untuk membuat kategori baru
    await fetch(`http://localhost:3000/api/categories/${id}`, {
        method: "PUT",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
    })

    return Astro.redirect("/dashboard/categories");
}
---

<Dashboard title="Categories">
    <form method="POST" class="max-w-3xl">
        <section class="bg-white rounded-xl shadow-sm">
            <!-- Header -->
            <div class="px-6 py-4 border-b">
                <h2 class="font-bold text-2xl">Edit Category</h2>
                <p class="text-sm text-gray-500">Perbarui data kategori ke sistem</p>
            </div>
            
            <!-- Form -->
            <div class="p-6 space-y-5">
                <!-- Category name -->
                <div>
                    <label for="Nama-kategori" class="block text-sm font-medium mb-1">
                        Category Name
                    </label>
                    <input type="text" name="category" value={category.name} placeholder="Masukkan nama kategori" class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-500 outline-none" required/>
                </div>
            </div>

            <!-- Button -->
            <div class="px-6 py-4 border-t flex justify-end gap-3">
                <a href="/dashboard/categories" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">
                    Cancel
                </a>
                <button type="submit" class="px-5 py-2 rounded-lg bg-pink-500 text-white hover:bg-pink-600">
                    Save
                </button>
            </div>
        </section>
    </form>
</Dashboard>